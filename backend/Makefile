# ğŸ” FastFood Backend - Makefile

.PHONY: help install dev test lint clean db-test db-migrate db-seed docker-build docker-run

# Default target
help:
	@echo "ğŸš€ FastFood Backend - Comandos DisponÃ­veis"
	@echo ""
	@echo "ğŸ“¦ Desenvolvimento:"
	@echo "  install     - Instalar dependÃªncias"
	@echo "  dev         - Executar servidor de desenvolvimento"
	@echo "  test        - Executar testes"
	@echo "  lint        - Verificar qualidade do cÃ³digo"
	@echo ""
	@echo "ğŸ—„ï¸  Database:"
	@echo "  db-test     - Testar conexÃ£o com banco"
	@echo "  db-migrate  - Executar migraÃ§Ãµes"
	@echo "  db-seed     - Popular banco com dados"
	@echo ""
	@echo "ğŸ³ Docker:"
	@echo "  docker-build - Construir imagem Docker"
	@echo "  docker-run   - Executar container"
	@echo ""
	@echo "ğŸ§¹ ManutenÃ§Ã£o:"
	@echo "  clean       - Limpar arquivos temporÃ¡rios"

# Development
install:
	@echo "ğŸ“¦ Instalando dependÃªncias..."
	poetry install

dev:
	@echo "ğŸš€ Iniciando servidor de desenvolvimento..."
	uvicorn src.main:app --reload --host 0.0.0.0 --port 8000

test:
	@echo "ğŸ§ª Executando testes..."
	pytest tests/ -v

lint:
	@echo "ğŸ” Verificando qualidade do cÃ³digo..."
	flake8 src/
	black --check src/
	isort --check-only src/

# Database
db-test:
	@echo "ğŸ—„ï¸  Testando conexÃ£o com banco..."
	python -c "from src.infrastructure.db.session import engine; print('âœ… ConexÃ£o OK') if engine else print('âŒ Falha na conexÃ£o')"

db-migrate:
	@echo "ğŸ”„ Executando migraÃ§Ãµes..."
	alembic upgrade head

db-seed:
	@echo "ğŸŒ± Populando banco com dados..."
	python script/popular_tb_produtos.py

# Docker
docker-build:
	@echo "ğŸ³ Construindo imagem Docker..."
	docker build -t fastfood-backend .

docker-run:
	@echo "ğŸ³ Executando container..."
	docker run -p 8000:8000 --env-file .env fastfood-backend

# Maintenance
clean:
	@echo "ğŸ§¹ Limpando arquivos temporÃ¡rios..."
	find . -type f -name "*.pyc" -delete
	find . -type d -name "__pycache__" -delete
	find . -type d -name "*.egg-info" -exec rm -rf {} +
	find . -type d -name ".pytest_cache" -exec rm -rf {} +
	find . -type d -name ".mypy_cache" -exec rm -rf {} + 